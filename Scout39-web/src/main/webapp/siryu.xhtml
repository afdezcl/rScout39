<ui:composition template="templates/eventos.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="title">Siryu</ui:define>
    <ui:define name="seccionnav">GRUPO SIRYU</ui:define>
    <ui:define name="eventos">

        <!-- Section: Blog v.1 -->
        <div class="col" id="eventos">
            <section class="mr-5 ml-6">
                <div class="row my-5">
                    <div class="col-6 col-sm-4"></div>
                    <!-- Section heading -->
                    <h2 class="h1-responsive font-weight-bold text-center col-6 col-sm-4">Eventos</h2>
                    <c:if test="#{controlAutorizacion.usuario.roles.nombrerol == 'ScouterSIRYU'}">
                        <div class="text-left col-6 col-sm-4">
                            <a class="btn btn-default btn-rounded mb-4 btn-blue" data-toggle="modal" data-target="#modalCrearEvento">Crear Evento</a>
                        </div>
                    </c:if>
                </div>
                <c:forEach items="#{beanEventos.eventosSIRYU}" var="evento">
                    <!-- Grid row -->
                    <div class="row border-default">

                        <!-- Grid column -->

                        <div class="col-6 col-sm-4">                            
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" src="https://www.google.com/maps/embed/v1/view?key=AIzaSyDwzZZYDEbnUpTTWcgbr3e3aUrXjjySciM&amp;center=#{evento.latitud.toString()},#{evento.longitud.toString()}&amp;zoom=16&amp;maptype=satellite"></iframe>
                            </div>
                        </div>
                        <!-- Grid column -->

                        <!-- Grid column -->
                        <div class="col-6 col-sm-4 text-center">

                            <!-- Category -->
                            <a href="#!" class="green-text"><h6 class="font-weight-bold mb-3"><i class="fa fa-calendar pr-2"></i>Evento</h6></a>
                            <!-- Post title -->
                            <h3 class="font-weight-bold mb-3"><strong>#{evento.nombre}</strong></h3>                            
                            <!-- Excerpt -->
                            <p>#{evento.descripcion}</p>
                            <!-- Post data -->                           
                            <p>#{evento.fecha.toLocaleString()}</p>
                            <!-- Read more button -->
                            <c:if test="#{controlAutorizacion.usuario.roles.nombrerol == 'ScouterSIRYU'}">
                                <a class="btn btn-success btn-md" data-toggle="collapse" href="#collapseParticipantes-#{evento.id.toString()}" aria-expanded="false" aria-controls="collapseParticipantes-#{evento.id.toString()}">Participantes</a>
                                <div class="collapse" id="collapseParticipantes-#{evento.id.toString()}">
                                    <div class="mt-3">
                                        <table class="table table-striped table-responsive-md btn-table">

                                            <!--Table head-->
                                            <thead>
                                                <tr>                                                
                                                    <th>Nombre</th>
                                                    <th>Apellidos</th>
                                                    <th>Nombre de Usuario</th>
                                                    <th>Correo electrónico</th>                                                                       
                                                    <th>Progresión</th>                                                
                                                </tr>
                                            </thead>
                                            <!--Table head-->
                                            <tbody>
                                                <tr>                                                
                                                    <td>Nombre</td>
                                                    <td>apellidos</td>
                                                    <td>alias</td>
                                                    <td>email</td>                                                                        
                                                    <td>
                                                        <button type="button" class="btn btn-default btn-rounded btn-sm my-0" data-toggle="modal" data-target="#rellenarProgresion">Rellenar</button>
                                                    </td>

                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </c:if>
                            #{ControlAsistencia.añadeEventoEnED(evento)}

                            <c:when test="#{controlAutorizacion.usuario.roles.nombrerol == 'EducandoSIRYU'}">
                                <c:choose> 
                                    <c:when test="#{ControlAsistencia.comprobarAsistencia(evento) eq false}">
                                        <h:form>
                                            <h:commandLink class="btn btn-success btn-md"  value ="Asistir" action="#{ControlAsistencia.asistirEvento(evento)}"></h:commandLink>
                                        </h:form>
                                    </c:when>
                                    <c:otherwise>
                                        <h:form>
                                            <h:commandLink class="btn btn-danger btn-md"  value ="Dejar de Asistir" action="#{ControlAsistencia.noAsistir(evento)}"></h:commandLink>
                                        </h:form>
                                    </c:otherwise>
                                </c:choose>
                            </c:when>


                        </div>
                        <!-- Grid column -->
                        <c:if test="#{controlAutorizacion.usuario.roles.nombrerol == 'ScouterSIRYU'}">
                            <div class="col-6 col-sm-4">
                                <div class="text-left">                                    
                                    <button class="btn btn-orange btn-rounded mb-4" data-toggle="modal" data-target="#modalModificarEvento#{evento.id.toString()}">Modificar</button>
                                </div>
                            </div>
                        </c:if>
                    </div>


                    <c:if test="#{controlAutorizacion.usuario.roles.nombrerol == 'ScouterSIRYU'}">
                        <!-- Grid row -->
                        <div class="modal fade" id="rellenarProgresion" tabindex="-1" role="dialog" aria-labelledby="rellenarProgresionLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <!--Header-->
                                    <div class="modal-header primary-color white-text">
                                        <h4 class="title">
                                            <i class="fa fa-tasks"></i> Rellenar Progresión</h4>
                                        <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p style="text-align: center;">Progresión</p>
                                    </div>
                                    <div class="modal-footer text-center">
                                        <button type="button" class="btn btn-default btn-success">Listo</button>                                    
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="modalModificarEvento#{evento.id.toString()}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header text-center">
                                        <h4 class="modal-title w-100 font-weight-bold">Modificar Evento</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">x</span>
                                        </button>
                                    </div>
                                    <div class="modal-body mx-3">
                                        <h:form id="formModificarEvento#{evento.id.toString()}">
                                            <!-- Material input text -->
                                            <div class="md-form">
                                                <i class="fa fa-font prefix grey-text"></i>
                                                <h:inputText class="form-control" id="modificarNombre" value="#{evento.nombre}"/>
                                                <h:outputLabel>Nombre Evento</h:outputLabel>
                                            </div>

                                            <div class="md-form">
                                                <i class="fa fa-font prefix grey-text"></i>
                                                <h:inputTextarea cols="20" rows="5" class="form-control" id="modificarDescripcion" value="#{evento.descripcion}"/>
                                                <h:outputLabel>Descripcion Evento</h:outputLabel>
                                            </div>

                                            <div class="md-form">
                                                <i class="fa fa-calendar prefix grey-text"></i>
                                                <h:inputText class="form-control" id="modificarFecha"/>
                                                <h:outputLabel>Fecha Evento</h:outputLabel>
                                            </div>

                                            <div class="md-form">
                                                <i class="fa fa-compass prefix grey-text"></i>
                                                <h:inputText class="form-control" id="modificarLatitud" value="#{evento.latitud}"/>
                                                <h:outputLabel>Latitud</h:outputLabel>
                                            </div>

                                            <div class="md-form">
                                                <i class="fa fa-compass prefix grey-text"></i>
                                                <h:inputText class="form-control" id="modificarLongitud" value="#{evento.longitud}"/>
                                                <h:outputLabel>Longitud</h:outputLabel>
                                            </div>

                                            <div class="text-center mt-4">
                                                <h:commandButton class="btn btn-orange" value="Modificar Evento" action="#{beanEventos.doModificarEvento(evento.id.toString())}"/>
                                            </div>
                                        </h:form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </c:if>
                    <hr class="my-5"/>

                </c:forEach>

            </section>
            <!-- Section: Blog v.1 -->
        </div>

        <div class="modal fade" id="modalCrearEvento" tabindex="-1" role="dialog" aria-labelledby="modalCrearEventoLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h4 class="modal-title w-100 font-weight-bold">Crear Evento</h4>
                        <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body mx-3">
                        <h:form id="formCrearEvento">

                            <!-- Material input text -->
                            <div class="md-form">
                                <i class="fa fa-font prefix grey-text"></i>
                                <h:inputText class="form-control" id="crearNombre"/>
                                <h:outputLabel for="formCrearEventoNombre">Nombre Evento</h:outputLabel>
                            </div>

                            <div class="md-form">
                                <i class="fa fa-font prefix grey-text"></i>
                                <h:inputTextarea cols="20" rows="5" class="form-control" id="crearDescripcion"/>
                                <h:outputLabel for="formCrearEventoDescripcion">Descripcion Evento</h:outputLabel>
                            </div>

                            <div class="md-form">
                                <h:inputText id="crearFecha" class="form-control datepicker"/>
                                <label >Seleccionar Fecha</label>
                            </div>
                            <div class="md-form">
                                <i class="fa fa-compass prefix grey-text"></i>
                                <h:inputText class="form-control" id="crearLatitud"/>
                                <h:outputLabel for="formCrearEventoLatitud">Latitud</h:outputLabel>
                            </div>

                            <div class="md-form">
                                <i class="fa fa-compass prefix grey-text"></i>
                                <h:inputText class="form-control" id="crearLongitud"/>
                                <h:outputLabel for="formCrearEventoLongitud">Longitud</h:outputLabel>
                            </div>

                            <div class="text-center mt-4">
                                <h:commandButton class="btn btn-primary" value="Crear Evento" action="#{beanEventos.doCrearEvento()}"/>
                            </div>
                        </h:form>

                    </div>

                </div>
            </div>
        </div>

    </ui:define>
    <ui:define name="sectionh">Nuestros mejores proyectos</ui:define>
</ui:composition>